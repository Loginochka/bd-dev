# Домашнее задание к занятию 4. «PostgreSQL» - Логинов Даниил

### Задача 1

Используя Docker, поднимите инстанс PostgreSQL (версию 13). Данные БД сохраните в volume.

Подключитесь к БД PostgreSQL, используя psql.

Воспользуйтесь командой \? для вывода подсказки по имеющимся в psql управляющим командам.

Найдите и приведите управляющие команды для:

* вывода списка БД,
* подключения к БД,
* вывода списка таблиц,
* вывода описания содержимого таблиц,
* выхода из psql.

### Ответ 1

Вывод списка БД: \l

Подключение к БД:\c <название_базы_данных>

Вывод списка таблиц: \dt

Вывод описания содержимого таблиц: \d+ <название_таблицы>

Выход из psql: \q

### Задача 2

Используя psql, создайте БД test_database.

Изучите бэкап БД.

Восстановите бэкап БД в test_database.

Перейдите в управляющую консоль psql внутри контейнера.

Подключитесь к восстановленной БД и проведите операцию ANALYZE для сбора статистики по таблице.

Используя таблицу pg_stats, найдите столбец таблицы orders с наибольшим средним значением размера элементов в байтах.

Приведите в ответе команду, которую вы использовали для вычисления, и полученный результат.

### Ответ 2

[Ответ 2]()

### Задача 3

Архитектор и администратор БД выяснили, что ваша таблица orders разрослась до невиданных размеров и поиск по ней занимает долгое время. Вам как успешному выпускнику курсов DevOps в Нетологии предложили провести разбиение таблицы на 2: шардировать на orders_1 - price>499 и orders_2 - price<=499.

Предложите SQL-транзакцию для проведения этой операции.

Можно ли было изначально исключить ручное разбиение при проектировании таблицы orders?

### Ответ 3

``SQL

BEGIN TRANSACTION;
CREATE TABLE orders_1 AS
SELECT * FROM orders WHERE price > 499;
CREATE TABLE orders_2 AS
SELECT * FROM orders WHERE price <= 499;
SELECT COUNT(*) FROM orders_1;
SELECT COUNT(*) FROM orders_2;
DROP TABLE orders;
COMMIT;

``SQL

Да, можно было использовать шардирования сразу при создании таблицы.
Это позволяет базе данных автоматически управлять распределением данных между различными шардами таблицы на основе определенного ключа или условия. Например:

``SQL

CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    price DECIMAL(10, 2),
    order_date DATE
) PARTITION BY RANGE (price) (
    PARTITION p_high VALUES LESS THAN (500),
    PARTITION p_low VALUES LESS THAN MAXVALUE
);

``SQL

### Задача 4

Используя утилиту pg_dump, создайте бекап БД test_database.

Как бы вы доработали бэкап-файл, чтобы добавить уникальность значения столбца title для таблиц test_database?

### Ответ 4

После создания дампа Бд, вручную дописал следующее:

``SQL

CREATE TABLE test_table (
    id serial PRIMARY KEY,
    title varchar(255) UNIQUE,
    description text
);

``SQL

UNIQUE добавил для уникальности столбца title